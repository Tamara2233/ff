gh repo create realtime-russian-chat --public --clone && cd realtime-russian-chat && echo '
// =========================
//  ONE-FILE REALTIME CHAT
//  EVERYTHING TRANSLATED TO RUSSIAN
//  RUN:  node server.js
// =========================

const http = require("http");
const fs = require("fs");
const fetch = require("node-fetch");
let clients = [];

const HTML = \`
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Чат (всё переводится на русский)</title>
<style>
body { font-family: Arial; background:#f3f3f3; margin:0; }
#chat { max-width:700px; margin:0 auto; padding:20px; }
#messages { height:400px; background:white; padding:10px; overflow-y:auto; border:1px solid #ccc; }
.msg { margin-bottom:10px; padding:5px 8px; background:#eef; border-radius:5px; }
small { color:#666; }
#inputBox { display:flex; margin-top:10px; gap:5px; }
input { flex:1; padding:8px; }
button { padding:8px 14px; }
#nick { margin-bottom:10px; width:100%; padding:8px; }
</style>
</head>
<body>
<div id="chat">
<h2>Общий чат (всё переводится на русский)</h2>

<input id="nick" placeholder="Ваш ник (необязательно)">

<div id="messages"></div>

<div id="inputBox">
<input id="msg" placeholder="Введите сообщение..." />
<button onclick="send()">Отправить</button>
</div>
</div>

<script>
const ws = new WebSocket("ws://" + location.host);

ws.onmessage = (ev) => {
    let m = JSON.parse(ev.data);
    let box = document.getElementById("messages");
    box.innerHTML += "<div class='msg'><b>" + m.user + ":</b> " + m.text +
                     "<br><small>Оригинал: " + m.original + "</small></div>";
    box.scrollTop = box.scrollHeight;
};

function send() {
    let msg = document.getElementById("msg").value.trim();
    if (!msg) return;
    let nick = document.getElementById("nick").value.trim() || "Anonymous";
    ws.send(JSON.stringify({ user: nick, text: msg }));
    document.getElementById("msg").value = "";
}
</script>

</body>
</html>
\`;

async function translateToRussian(text) {
    try {
        const res = await fetch("https://libretranslate.com/translate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                q: text,
                source: "auto",
                target: "ru",
                format: "text"
            })
        });
        const json = await res.json();
        return json.translatedText || text;
    } catch {
        return text;
    }
}

const server = http.createServer((req, res) => {
    res.writeHead(200, { "Content-Type": "text/html" });
    res.end(HTML);
});

const WebSocket = require("ws");
const wss = new WebSocket.Server({ server });

wss.on("connection", (ws) => {
    clients.push(ws);

    ws.on("message", async (data) => {
        const msg = JSON.parse(data.toString());
        const translated = await translateToRussian(msg.text);

        const payload = JSON.stringify({
            user: msg.user,
            original: msg.text,
            text: translated
        });

        clients.forEach(c => {
            if (c.readyState === WebSocket.OPEN) c.send(payload);
        });
    });

    ws.on("close", () => {
        clients = clients.filter(c => c !== ws);
    });
});

server.listen(3000, () =>
    console.log("Chat running on http://localhost:3000")
);
' > server.js && echo '{}' > package.json && git add . && git commit -m "Initial chat commit" && git push
